<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ã€ëª¨ë“  ê²½ê³  ì œê±°ã€‘ ì™„ë²½ ìµœì¢…ë³¸</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; text-align: center; color: #333; }
        h1 { font-weight: 600; }
        #captureArea { width: 600px; height: 300px; border: 2px dashed #ccc; background-color: #fff; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .animated-box { width: 80px; height: 80px; background-color: #0d6efd; animation: moveAndChange 5s linear infinite; }
        @keyframes moveAndChange {
            0%   { transform: translateX(-250px) rotate(0deg); background-color: #0d6efd; border-radius: 0; }
            50%  { transform: translateX(250px) rotate(180deg); background-color: #dc3545; border-radius: 50%; }
            100% { transform: translateX(-250px) rotate(360deg); background-color: #0d6efd; border-radius: 0; }
        }
        #recordBtn { font-size: 18px; padding: 12px 24px; cursor: pointer; border: none; background-color: #198754; color: white; border-radius: 8px; transition: background-color 0.2s, transform 0.1s; font-weight: 500; }
        #recordBtn:hover { background-color: #157347; }
        #recordBtn:active { transform: scale(0.98); }
        #recordBtn:disabled { background-color: #6c757d; cursor: not-allowed; }
        #status { font-size: 16px; height: 24px; margin-top: 10px; color: #555; }
    </style>
</head>
<body>

    <h1>ì›€ì§ì´ëŠ” í˜ì´ì§€ë¥¼ ì›€ì§¤ë¡œ ë§Œë“¤ê¸°</h1>
    <div id="captureArea">
        <div class="animated-box"></div>
    </div>
    
    <button id="recordBtn">ì›€ì§¤ ë§Œë“¤ê¸° ì‹œì‘!</button>
    <p id="status">ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ 5ì´ˆê°„ ë…¹í™”í•©ë‹ˆë‹¤.</p>

    <!--
    â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
    ã€ë§ˆë²•ì˜ í•µ ì½”ë“œã€‘
    ì´ ì½”ë“œê°€ gif.js ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê²½ê³  ë©”ì‹œì§€ë¥¼ ì›ì²œ ì°¨ë‹¨í•©ë‹ˆë‹¤.
    â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
    -->
    <script>
        (function() {
            // ìº”ë²„ìŠ¤ì˜ getContext ê¸°ë³¸ ê¸°ëŠ¥ì„ ë¯¸ë¦¬ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.
            const originalGetContext = HTMLCanvasElement.prototype.getContext;

            // ì´ì œ getContext í•¨ìˆ˜ë¥¼ ìš°ë¦¬ ì…ë§›ì— ë§ê²Œ ìƒˆë¡œ ì •ì˜í•©ë‹ˆë‹¤.
            HTMLCanvasElement.prototype.getContext = function(type, options) {
                if (type === '2d') {
                    // ì˜µì…˜ì— willReadFrequentlyë¥¼ ê°•ì œë¡œ ì¶”ê°€í•©ë‹ˆë‹¤.
                    const newOptions = Object.assign({}, options, { willReadFrequently: true });
                    // ì„±ëŠ¥ ì˜µì…˜ì´ ì¶”ê°€ëœ ì±„ë¡œ ì›ë˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
                    return originalGetContext.call(this, type, newOptions);
                }
                // '2d'ê°€ ì•„ë‹Œ ë‹¤ë¥¸ íƒ€ì…(ì˜ˆ: 'webgl')ì€ ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤.
                return originalGetContext.call(this, type, options);
            };
        })();
    </script>

    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ê·¸ëŒ€ë¡œ ë§ˆì§€ë§‰ì— ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const recordBtn = document.getElementById('recordBtn');
            const statusEl = document.getElementById('status');
            const captureArea = document.getElementById('captureArea');

            recordBtn.addEventListener('click', async () => {
                try {
                    recordBtn.disabled = true;
                    statusEl.textContent = "ë…¹í™” ì¤€ë¹„ ì¤‘...";

                    const gif = new GIF({
                        workers: 2,
                        quality: 10,
                        workerScript: 'gif.worker.js' // ë‚´ ì €ì¥ì†Œì— ìˆëŠ” ì¼ê¾¼ íŒŒì¼ì„ ì§€ì •
                    });

                    const DURATION = 5000;
                    const FRAME_RATE = 20;
                    const totalFrames = DURATION / 1000 * FRAME_RATE;
                    
                    for (let i = 0; i < totalFrames; i++) {
                        const canvas = await html2canvas(captureArea, { logging: false });
                        
                        // ì´ì œ ìœ„ 'í•µ' ì½”ë“œ ë•ë¶„ì—, ì´ ì•„ë˜ ì½”ë“œê°€ ì—†ì–´ë„
                        // gif.js ë‚´ë¶€ì˜ ê²½ê³ ê¹Œì§€ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
                        gif.addFrame(canvas, { delay: 1000 / FRAME_RATE });
                        
                        statusEl.textContent = `í”„ë ˆì„ ìº¡ì²˜ ì¤‘... ${Math.round(((i + 1) / totalFrames) * 100)}%`;
                    }

                    statusEl.textContent = 'ì›€ì§¤ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                    
                    gif.on('progress', function(p) {
                        statusEl.textContent = `ì›€ì§¤ ìƒì„± ì¤‘... ${Math.round(p * 100)}%`;
                    });

                    gif.on('finished', function(blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'animation.gif';
                        a.click();
                        URL.revokeObjectURL(url);

                        recordBtn.disabled = false;
                        statusEl.textContent = 'ğŸ‰ ì›€ì§¤ ìƒì„± ì™„ë£Œ!';
                    });

                    gif.render();

                } catch (error) {
                    console.error("ì›€ì§¤ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    statusEl.textContent = "ì˜¤ë¥˜ ë°œìƒ! F12ë¥¼ ëˆŒëŸ¬ ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.";
                    recordBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>
