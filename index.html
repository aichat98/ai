<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>【최종 완성】 깃허브 페이지 움짤 메이커</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; text-align: center; color: #333; }
        h1 { font-weight: 600; }
        #captureArea { width: 600px; height: 300px; border: 2px dashed #ccc; background-color: #fff; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .animated-box { width: 80px; height: 80px; background-color: #0d6efd; animation: moveAndChange 5s linear infinite; }
        @keyframes moveAndChange {
            0%   { transform: translateX(-250px) rotate(0deg); background-color: #0d6efd; border-radius: 0; }
            50%  { transform: translateX(250px) rotate(180deg); background-color: #dc3545; border-radius: 50%; }
            100% { transform: translateX(-250px) rotate(360deg); background-color: #0d6efd; border-radius: 0; }
        }
        #recordBtn { font-size: 18px; padding: 12px 24px; cursor: pointer; border: none; background-color: #198754; color: white; border-radius: 8px; transition: background-color 0.2s, transform 0.1s; font-weight: 500; }
        #recordBtn:hover { background-color: #157347; }
        #recordBtn:active { transform: scale(0.98); }
        #recordBtn:disabled { background-color: #6c757d; cursor: not-allowed; }
        #status { font-size: 16px; height: 24px; margin-top: 10px; color: #555; }
    </style>
</head>
<body>

    <h1>움직이는 페이지를 움짤로 만들기</h1>
    <div id="captureArea">
        <div class="animated-box"></div>
    </div>
    
    <button id="recordBtn">움짤 만들기 시작!</button>
    <p id="status">버튼을 누르면 5초간 녹화합니다.</p>

    <!-- 외부 라이브러리: gif.worker.js 파일과 함께 깃허브에 올려야 합니다. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const recordBtn = document.getElementById('recordBtn');
            const statusEl = document.getElementById('status');
            const captureArea = document.getElementById('captureArea');

            recordBtn.addEventListener('click', async () => {
                try {
                    recordBtn.disabled = true;
                    statusEl.textContent = "녹화 준비 중...";

                    const gif = new GIF({
                        workers: 2,
                        quality: 10,
                        workerScript: 'gif.worker.js' // 내 저장소에 있는 일꾼 파일을 지정
                    });

                    const DURATION = 5000;
                    const FRAME_RATE = 20;
                    const totalFrames = DURATION / 1000 * FRAME_RATE;
                    
                    for (let i = 0; i < totalFrames; i++) {
                        const canvas = await html2canvas(captureArea, { logging: false });
                        
                        // 이 코드는 html2canvas에 대한 경고를 막아줍니다.
                        canvas.getContext('2d', { willReadFrequently: true });
                        
                        // gif.js 라이브러리 내부에서 발생하는 경고는 저희가 막을 수 없지만, 기능에는 문제가 없습니다.
                        gif.addFrame(canvas, { delay: 1000 / FRAME_RATE });
                        
                        statusEl.textContent = `프레임 캡처 중... ${Math.round(((i + 1) / totalFrames) * 100)}%`;
                    }

                    statusEl.textContent = '움짤을 생성하고 있습니다...';
                    
                    gif.on('progress', function(p) {
                        statusEl.textContent = `움짤 생성 중... ${Math.round(p * 100)}%`;
                    });

                    gif.on('finished', function(blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'animation.gif';
                        a.click();
                        URL.revokeObjectURL(url);

                        recordBtn.disabled = false;
                        statusEl.textContent = '🎉 움짤 생성 완료!';
                    });

                    gif.render();

                } catch (error) {
                    console.error("움짤 생성 중 오류 발생:", error);
                    statusEl.textContent = "오류 발생! F12를 눌러 콘솔을 확인하세요.";
                    recordBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>
