<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê¹ƒí—ˆë¸Œ í˜ì´ì§€ìš© ì›€ì§¤ ë©”ì´ì»¤</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; text-align: center; color: #333; }
        h1 { font-weight: 600; }
        #captureArea { width: 600px; height: 300px; border: 2px dashed #ccc; background-color: #fff; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .animated-box { width: 80px; height: 80px; background-color: #0d6efd; animation: moveAndChange 5s linear infinite; }
        @keyframes moveAndChange {
            0%   { transform: translateX(-250px) rotate(0deg); background-color: #0d6efd; border-radius: 0; }
            50%  { transform: translateX(250px) rotate(180deg); background-color: #dc3545; border-radius: 50%; }
            100% { transform: translateX(-250px) rotate(360deg); background-color: #0d6efd; border-radius: 0; }
        }
        #recordBtn { font-size: 18px; padding: 12px 24px; cursor: pointer; border: none; background-color: #198754; color: white; border-radius: 8px; transition: background-color 0.2s, transform 0.1s; font-weight: 500; }
        #recordBtn:hover { background-color: #157347; }
        #recordBtn:active { transform: scale(0.98); }
        #recordBtn:disabled { background-color: #6c757d; cursor: not-allowed; }
        #status { font-size: 16px; height: 24px; margin-top: 10px; color: #555; }
    </style>
</head>
<body>

    <h1>ì›€ì§ì´ëŠ” í˜ì´ì§€ë¥¼ ì›€ì§¤ë¡œ ë§Œë“¤ê¸°</h1>
    <div id="captureArea">
        <div class="animated-box"></div>
    </div>
    
    <button id="recordBtn">ì›€ì§¤ ë§Œë“¤ê¸° ì‹œì‘!</button>
    <p id="status">ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ 5ì´ˆê°„ ë…¹í™”í•©ë‹ˆë‹¤.</p>

    <!-- ì•ˆì •ì ì¸ ì™¸ë¶€ ì„œë²„ì—ì„œ ê²€ì¦ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const recordBtn = document.getElementById('recordBtn');
            const statusEl = document.getElementById('status');
            const captureArea = document.getElementById('captureArea');

            recordBtn.addEventListener('click', async () => {
                try {
                    recordBtn.disabled = true;
                    statusEl.textContent = "ë…¹í™” ì¤€ë¹„ ì¤‘...";

                    // ì´ì œ ì›¹ ì„œë²„ í™˜ê²½ì´ë¯€ë¡œ workersë¥¼ ë‹¤ì‹œ ì‚¬ìš©í•´ì„œ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                    const gif = new GIF({
                        workers: 2, // ì¼ê¾¼ 2ëª… ì‚¬ìš©
                        quality: 10,
                        workerScript: 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js' // ì¼ê¾¼ ìŠ¤í¬ë¦½íŠ¸ ê²½ë¡œ
                    });

                    const DURATION = 5000;
                    const FRAME_RATE = 20;
                    const totalFrames = DURATION / 1000 * FRAME_RATE;
                    
                    for (let i = 0; i < totalFrames; i++) {
                        const canvas = await html2canvas(captureArea, { logging: false });
                        canvas.getContext('2d', { willReadFrequently: true });
                        gif.addFrame(canvas, { delay: 1000 / FRAME_RATE });
                        
                        // ì§„í–‰ ìƒí™©ì„ ë¶€ë“œëŸ½ê²Œ í‘œì‹œí•©ë‹ˆë‹¤.
                        statusEl.textContent = `í”„ë ˆì„ ìº¡ì²˜ ì¤‘... ${Math.round(((i + 1) / totalFrames) * 100)}%`;
                    }

                    statusEl.textContent = 'ì›€ì§¤ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                    
                    // ì›€ì§¤ ìƒì„± ì§„í–‰ë¥ ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
                    gif.on('progress', function(p) {
                        statusEl.textContent = `ì›€ì§¤ ìƒì„± ì¤‘... ${Math.round(p * 100)}%`;
                    });

                    gif.on('finished', function(blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'animation.gif';
                        a.click();
                        URL.revokeObjectURL(url);

                        recordBtn.disabled = false;
                        statusEl.textContent = 'ğŸ‰ ì›€ì§¤ ìƒì„± ì™„ë£Œ!';
                    });

                    gif.render();

                } catch (error) {
                    console.error("ì›€ì§¤ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    statusEl.textContent = "ì˜¤ë¥˜ ë°œìƒ! F12ë¥¼ ëˆŒëŸ¬ ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.";
                    recordBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>
